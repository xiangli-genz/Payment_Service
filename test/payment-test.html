<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demo Thanh To√°n V√© Xe</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-bottom: 20px;
    }

    .invoice-header {
      border-bottom: 3px solid #667eea;
      padding-bottom: 20px;
      margin-bottom: 25px;
    }

    .invoice-header h2 {
      color: #667eea;
      font-size: 1.8em;
      margin-bottom: 5px;
    }

    .invoice-number {
      color: #666;
      font-size: 0.9em;
    }

    .trip-info {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
    }

    .trip-route {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .location {
      flex: 1;
      text-align: center;
    }

    .location-name {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .location-time {
      font-size: 0.9em;
      opacity: 0.9;
    }

    .arrow {
      font-size: 2em;
      padding: 0 20px;
    }

    .trip-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(255,255,255,0.3);
    }

    .detail-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .detail-item .icon {
      font-size: 1.2em;
    }

    .passenger-info {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
    }

    .passenger-info h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .info-row {
      display: flex;
      padding: 12px 0;
      border-bottom: 1px solid #e0e0e0;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-label {
      width: 150px;
      color: #666;
      font-weight: 600;
    }

    .info-value {
      flex: 1;
      color: #333;
    }

    .seat-info {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 25px;
    }

    .seat-info strong {
      color: #856404;
    }

    .price-breakdown {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #e0e0e0;
    }

    .price-row:last-child {
      border-bottom: none;
      border-top: 2px solid #667eea;
      margin-top: 10px;
      padding-top: 15px;
      font-size: 1.3em;
      font-weight: bold;
      color: #667eea;
    }

    .price-label {
      color: #666;
    }

    .price-value {
      color: #333;
      font-weight: 600;
    }

    .payment-methods {
      margin-bottom: 25px;
    }

    .payment-methods h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .method-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .method-card {
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }

    .method-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }

    .method-card.active {
      border-color: #667eea;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    }

    .method-card.active::after {
      content: '‚úì';
      position: absolute;
      top: 10px;
      right: 10px;
      background: #667eea;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .method-icon {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .method-name {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .method-desc {
      font-size: 0.85em;
      color: #666;
    }

    .btn-payment {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.2em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .btn-payment:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    .btn-payment:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .status-message {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      display: none;
    }

    .status-message.show {
      display: block;
    }

    .status-message.success {
      background: #d1fae5;
      color: #065f46;
      border-left: 4px solid #10b981;
    }

    .status-message.error {
      background: #fee2e2;
      color: #991b1b;
      border-left: 4px solid #ef4444;
    }

    .status-message.info {
      background: #dbeafe;
      color: #1e40af;
      border-left: 4px solid #3b82f6;
    }

    .demo-note {
      background: #fff3cd;
      border: 2px dashed #ffc107;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
    }

    .demo-note h3 {
      color: #856404;
      margin-bottom: 10px;
    }

    .demo-note p {
      color: #856404;
      margin-bottom: 15px;
    }

    .demo-note code {
      background: rgba(0,0,0,0.1);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.9em;
    }

    @media (max-width: 768px) {
      .method-grid {
        grid-template-columns: 1fr;
      }

      .trip-details {
        grid-template-columns: 1fr;
      }

      .trip-route {
        flex-direction: column;
      }

      .arrow {
        transform: rotate(90deg);
        padding: 10px 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üé´ Thanh To√°n V√© Xe</h1>
      <p>Ho√†n t·∫•t ƒë·∫∑t v√© c·ªßa b·∫°n</p>
    </div>

    <div class="demo-note">
      <h3>üß™ DEMO MODE</h3>
      <p>ƒê√¢y l√† giao di·ªán demo. V√¨ ch∆∞a c√≥ credentials th·∫≠t (MoMo, ZaloPay, VNPay),<br>
      h·ªá th·ªëng s·∫Ω <strong>m√¥ ph·ªèng thanh to√°n CASH</strong> (thanh to√°n t·∫°i qu·∫ßy).</p>
      <p><code>Status: COMPLETED</code> s·∫Ω ƒë∆∞·ª£c set ngay l·∫≠p t·ª©c</p>
    </div>

    <div class="card">
      <div class="invoice-header">
        <h2>üìã H√≥a ƒê∆°n Thanh To√°n</h2>
        <p class="invoice-number">M√£ ƒë·∫∑t v√©: <strong id="bookingCode">BK2026-001</strong></p>
      </div>

      <!-- Th√¥ng tin chuy·∫øn ƒëi -->
      <div class="trip-info">
        <div class="trip-route">
          <div class="location">
            <div class="location-name">H√† N·ªôi</div>
            <div class="location-time">‚è∞ 08:00 - 11/01/2026</div>
          </div>
          <div class="arrow">‚Üí</div>
          <div class="location">
            <div class="location-name">H·∫£i Ph√≤ng</div>
            <div class="location-time">‚è∞ 10:30 - 11/01/2026</div>
          </div>
        </div>
        
        <div class="trip-details">
          <div class="detail-item">
            <span class="icon">üöå</span>
            <span>Nh√† xe: <strong>Ph∆∞∆°ng Trang</strong></span>
          </div>
          <div class="detail-item">
            <span class="icon">‚è±Ô∏è</span>
            <span>Th·ªùi gian: <strong>2.5 gi·ªù</strong></span>
          </div>
          <div class="detail-item">
            <span class="icon">üí∫</span>
            <span>Lo·∫°i xe: <strong>Gi∆∞·ªùng n·∫±m</strong></span>
          </div>
          <div class="detail-item">
            <span class="icon">ü™™</span>
            <span>Bi·ªÉn s·ªë: <strong>29A-12345</strong></span>
          </div>
        </div>
      </div>

      <!-- Th√¥ng tin h√†nh kh√°ch -->
      <div class="passenger-info">
        <h3>üë§ Th√¥ng Tin H√†nh Kh√°ch</h3>
        <div class="info-row">
          <span class="info-label">H·ªç v√† t√™n:</span>
          <span class="info-value" id="customerName">Nguy·ªÖn VƒÉn A</span>
        </div>
        <div class="info-row">
          <span class="info-label">S·ªë ƒëi·ªán tho·∫°i:</span>
          <span class="info-value" id="customerPhone">0912 345 678</span>
        </div>
        <div class="info-row">
          <span class="info-label">Email:</span>
          <span class="info-value" id="customerEmail">nguyenvana@example.com</span>
        </div>
        <div class="info-row">
          <span class="info-label">CMND/CCCD:</span>
          <span class="info-value">001234567890</span>
        </div>
      </div>

      <!-- Th√¥ng tin gh·∫ø -->
      <div class="seat-info">
        <strong>üí∫ Gh·∫ø ƒë√£ ch·ªçn:</strong> A12, A13 (2 gh·∫ø)
      </div>

      <!-- Chi ti·∫øt gi√° -->
      <div class="price-breakdown">
        <div class="price-row">
          <span class="price-label">Gi√° v√© (2 ng∆∞·ªùi x 150.000ƒë):</span>
          <span class="price-value">300.000ƒë</span>
        </div>
        <div class="price-row">
          <span class="price-label">Ph√≠ d·ªãch v·ª•:</span>
          <span class="price-value">10.000ƒë</span>
        </div>
        <div class="price-row">
          <span class="price-label">Gi·∫£m gi√°:</span>
          <span class="price-value" style="color: #10b981;">-10.000ƒë</span>
        </div>
        <div class="price-row">
          <span class="price-label">T·ªïng thanh to√°n:</span>
          <span class="price-value" id="totalAmount">300.000ƒë</span>
        </div>
      </div>

      <!-- Ph∆∞∆°ng th·ª©c thanh to√°n -->
      <div class="payment-methods">
        <h3>üí≥ Ch·ªçn Ph∆∞∆°ng Th·ª©c Thanh To√°n</h3>
        <div class="method-grid">
          <div class="method-card active" data-method="cash" onclick="selectMethod('cash')">
            <div class="method-icon">üíµ</div>
            <div class="method-name">Ti·ªÅn M·∫∑t</div>
            <div class="method-desc">Thanh to√°n t·∫°i qu·∫ßy</div>
          </div>
          <div class="method-card" data-method="momo" onclick="selectMethod('momo')">
            <div class="method-icon">üí≥</div>
            <div class="method-name">MoMo</div>
            <div class="method-desc">V√≠ ƒëi·ªán t·ª≠ MoMo</div>
          </div>
          <div class="method-card" data-method="zalopay" onclick="selectMethod('zalopay')">
            <div class="method-icon">üí∞</div>
            <div class="method-name">ZaloPay</div>
            <div class="method-desc">V√≠ ZaloPay</div>
          </div>
          <div class="method-card" data-method="vnpay" onclick="selectMethod('vnpay')">
            <div class="method-icon">üè¶</div>
            <div class="method-name">VNPay</div>
            <div class="method-desc">C·ªïng thanh to√°n VNPay</div>
          </div>
          <div class="method-card" data-method="bank" onclick="selectMethod('bank')">
            <div class="method-icon">üèß</div>
            <div class="method-name">Ng√¢n H√†ng</div>
            <div class="method-desc">Chuy·ªÉn kho·∫£n</div>
          </div>
          <div class="method-card" data-method="credit" onclick="selectMethod('credit')">
            <div class="method-icon">üí≥</div>
            <div class="method-name">Th·∫ª T√≠n D·ª•ng</div>
            <div class="method-desc">Visa/MasterCard</div>
          </div>
        </div>
      </div>

      <!-- N√∫t thanh to√°n -->
      <button class="btn-payment" id="btnPayment" onclick="processPayment()">
        <span>üîí Thanh To√°n An To√†n</span>
      </button>

      <div class="status-message" id="statusMessage"></div>
    </div>

    <!-- Response Card (·∫©n ban ƒë·∫ßu) -->
    <div class="card" id="responseCard" style="display: none;">
      <h2 style="color: #667eea; margin-bottom: 15px;">üìä Response t·ª´ Server</h2>
      <pre id="responseData" style="background: #f8f9fa; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 13px;"></pre>
    </div>
  </div>

  <script>
    let selectedMethod = 'cash';
    const serviceUrl = 'http://localhost:3003'; // URL c·ªßa payment service

    // T·∫°o booking code ng·∫´u nhi√™n
    const bookingCode = `BK${Date.now().toString().slice(-6)}`;
    document.getElementById('bookingCode').textContent = bookingCode;

    function selectMethod(method) {
      selectedMethod = method;
      document.querySelectorAll('.method-card').forEach(card => {
        card.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
    }

    function showStatus(message, type = 'info') {
      const statusEl = document.getElementById('statusMessage');
      statusEl.className = `status-message show ${type}`;
      statusEl.innerHTML = message;
    }

    function showResponse(data) {
      document.getElementById('responseCard').style.display = 'block';
      document.getElementById('responseData').textContent = JSON.stringify(data, null, 2);
      
      // Scroll to response
      setTimeout(() => {
        document.getElementById('responseCard').scrollIntoView({ behavior: 'smooth' });
      }, 100);
    }

    async function processPayment() {
      const btn = document.getElementById('btnPayment');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> <span>ƒêang x·ª≠ l√Ω...</span>';

      // T·∫°o payload
      const payload = {
        bookingId: `BOOKING_${Date.now()}`,
        bookingCode: bookingCode,
        amount: 300000,
        method: selectedMethod,
        customerName: document.getElementById('customerName').textContent,
        customerPhone: document.getElementById('customerPhone').textContent,
        customerEmail: document.getElementById('customerEmail').textContent,
        metadata: {
          route: 'H√† N·ªôi - H·∫£i Ph√≤ng',
          departureTime: '08:00 - 11/01/2026',
          seats: ['A12', 'A13'],
          busCompany: 'Ph∆∞∆°ng Trang',
          busType: 'Gi∆∞·ªùng n·∫±m'
        }
      };

      showStatus(`‚è≥ ƒêang t·∫°o thanh to√°n v·ªõi ph∆∞∆°ng th·ª©c: <strong>${getMethodName(selectedMethod)}</strong>`, 'info');

      try {
        const response = await fetch(`${serviceUrl}/api/payments/create`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (response.ok && data.code === 'success') {
          showResponse(data);

          if (selectedMethod === 'cash') {
            showStatus(`
              ‚úÖ <strong>ƒê·∫∑t v√© th√†nh c√¥ng!</strong><br>
              M√£ thanh to√°n: <strong>${data.data.paymentCode}</strong><br>
              Tr·∫°ng th√°i: <strong>${data.data.status}</strong><br><br>
              üìù Vui l√≤ng thanh to√°n ti·ªÅn m·∫∑t t·∫°i qu·∫ßy tr∆∞·ªõc gi·ªù kh·ªüi h√†nh.<br>
              üí∞ S·ªë ti·ªÅn: <strong>300.000ƒë</strong>
            `, 'success');
          } else if (data.data.paymentUrl) {
            showStatus(`
              ‚úÖ <strong>T·∫°o thanh to√°n th√†nh c√¥ng!</strong><br>
              M√£ thanh to√°n: <strong>${data.data.paymentCode}</strong><br><br>
              üîó ƒêang chuy·ªÉn ƒë·∫øn trang thanh to√°n ${getMethodName(selectedMethod)}...<br>
              (Trong m√¥i tr∆∞·ªùng th·∫≠t, b·∫°n s·∫Ω ƒë∆∞·ª£c redirect ƒë·∫øn payment gateway)
            `, 'success');

            // Trong th·ª±c t·∫ø, s·∫Ω redirect:
            // window.location.href = data.data.paymentUrl;
            
            setTimeout(() => {
              showStatus(`
                ‚ÑπÔ∏è <strong>L∆∞u √Ω:</strong> Do ch∆∞a c√≥ credentials th·∫≠t, payment URL kh√¥ng ho·∫°t ƒë·ªông.<br>
                URL: <code style="font-size: 0.85em; word-break: break-all;">${data.data.paymentUrl}</code><br><br>
                ƒê·ªÉ test th·∫≠t, c·∫ßn config credentials trong file .env
              `, 'info');
            }, 2000);
          } else {
            showStatus(`
              ‚úÖ <strong>T·∫°o thanh to√°n th√†nh c√¥ng!</strong><br>
              M√£ thanh to√°n: <strong>${data.data.paymentCode}</strong><br>
              Tr·∫°ng th√°i: <strong>${data.data.status}</strong>
            `, 'success');
          }

          btn.innerHTML = '‚úì Ho√†n T·∫•t';
        } else {
          showResponse(data);
          showStatus(`
            ‚ùå <strong>C√≥ l·ªói x·∫£y ra!</strong><br>
            ${data.message || 'Kh√¥ng th·ªÉ t·∫°o thanh to√°n'}
          `, 'error');
          
          btn.disabled = false;
          btn.innerHTML = '<span>üîí Thanh To√°n An To√†n</span>';
        }

      } catch (error) {
        console.error('Payment error:', error);
        
        showStatus(`
          ‚ùå <strong>L·ªói k·∫øt n·ªëi!</strong><br>
          ${error.message}<br><br>
          ƒê·∫£m b·∫£o Payment Service ƒëang ch·∫°y t·∫°i <code>${serviceUrl}</code>
        `, 'error');

        btn.disabled = false;
        btn.innerHTML = '<span>üîí Thanh To√°n An To√†n</span>';
      }
    }

    function getMethodName(method) {
      const names = {
        'cash': 'Ti·ªÅn M·∫∑t',
        'momo': 'MoMo',
        'zalopay': 'ZaloPay',
        'vnpay': 'VNPay',
        'bank': 'Ng√¢n H√†ng',
        'credit': 'Th·∫ª T√≠n D·ª•ng'
      };
      return names[method] || method;
    }
  </script>
</body>
</html>